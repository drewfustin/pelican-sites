!function(e){e.fn.tipuesearch=function(i){var t=e.extend({show:7,newWindow:!1,showURL:!0,minimumLength:3,descriptiveWords:25,highlightTerms:!0,highlightEveryTerm:!1,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json"},i);return this.each(function(){var i={pages:[]};if(e.ajaxSetup({async:!1}),"live"==t.mode)for(var r=0;r<tipuesearch_pages.length;r++)e.get(tipuesearch_pages[r],"",function(a){var s=e(t.liveContent,a).text();s=s.replace(/\s+/g," ");var o=e(t.liveDescription,a).text();o=o.replace(/\s+/g," ");var c=a.toLowerCase().indexOf("<title>"),n=a.toLowerCase().indexOf("</title>",c+7);if(-1!=c&&-1!=n)var h=a.slice(c+7,n);else h="No title";i.pages.push({title:h,text:o,tags:s,url:tipuesearch_pages[r]})});"json"==t.mode&&e.getJSON(t.contentLocation,function(t){i=e.extend({},t)}),"static"==t.mode&&(i=e.extend({},tipuesearch));var a="";function s(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function o(r,s){e("#tipue_search_content").hide();var c="",n=!1,h=!1,d=e("#tipue_search_input").val().toLowerCase(),l=(d=e.trim(d)).split(" ");d="";for(var p=0;p<l.length;p++){for(var u=!0,_=0;_<tipuesearch_stop_words.length;_++)l[p]==tipuesearch_stop_words[_]&&(u=!1,h=!0);u&&(d=d+" "+l[p])}if(l=(d=e.trim(d)).split(" "),d.length>=t.minimumLength){if(s){var g=d;for(p=0;p<l.length;p++)for(_=0;_<tipuesearch_replace.words.length;_++)l[p]==tipuesearch_replace.words[_].word&&(d=d.replace(l[p],tipuesearch_replace.words[_].replace_with),n=!0);l=d.split(" ")}var v=d;for(p=0;p<l.length;p++)for(_=0;_<tipuesearch_stem.words.length;_++)l[p]==tipuesearch_stem.words[_].word&&(v=v+" "+tipuesearch_stem.words[_].stem);l=v.split(" ");var f=0;found=new Array;for(p=0;p<i.pages.length;p++){var w=1e9,m=i.pages[p].text;for(_=0;_<l.length;_++){var x=new RegExp(l[_],"i");if(-1!=i.pages[p].title.search(x)&&(w-=2e5-p),-1!=i.pages[p].summary.search(x)&&(w-=18e4-p),-1!=i.pages[p].text.search(x)&&(w-=15e4-p),t.highlightTerms){if(t.highlightEveryTerm)var b=new RegExp("("+l[_]+")","gi");else b=new RegExp("("+l[_]+")","i");m=m.replace(b,"<b>$1</b>")}-1!=i.pages[p].tags.search(x)&&(w-=1e5-p)}w<1e9&&(found[f++]=w+"^"+i.pages[p].title+"^"+m+"^"+i.pages[p].url+"^"+i.pages[p].summary+"^"+i.pages[p].image+"^"+i.pages[p].date+"^"+i.pages[p].locale_date)}if(0!=f){1==n&&(c+='<div id="tipue_search_warning_head">Showing results for '+d+"</div>",c+='<div id="tipue_search_warning">Search for <a href="javascript:void(0)" id="tipue_search_replaced">'+g+"</a></div>"),1==f?(c+='<div id="tipue_search_results_count">1 result</div>',c+="<hr>"):(c_c=f.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),c+='<div id="tipue_search_results_count">'+c_c+" results</div>",c+="<hr>"),found.sort();var L=0;for(p=0;p<found.length;p++){var y=found[p].split("^");L>=r&&L<t.show+r&&(c+='<div class="article-list">',c+='<a href="'+y[3]+'"'+a+'><img src="'+y[5]+'"></a>',c+='<header><a href="'+y[3]+'"'+a+">"+y[1]+"</a></header>",c+='<time datetime="'+y[6]+'">'+y[7]+"</time>",c+=y[4],t.showURL&&(c+='<div class="tipue_search_content_loc"><a href="'+y[3]+'"'+a+">"+y[3]+"</a></div>"),c+="</div>"),L++}if(f>t.show){var j=Math.ceil(f/t.show),C=r/t.show;if(c+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">',r>0&&(c+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(r-t.show)+"_"+s+'">&#171; Prev</a></li>'),C<=2){var S=j;j>3&&(S=3);for(_=0;_<S;_++)c+=_==C?'<li class="current">'+(_+1)+"</li>":'<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+_*t.show+"_"+s+'">'+(_+1)+"</a></li>"}else{(S=j+2)>j&&(S=j);for(_=C;_<S;_++)c+=_==C?'<li class="current">'+(_+1)+"</li>":'<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+_*t.show+"_"+s+'">'+(_+1)+"</a></li>"}C+1!=j&&(c+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(r+t.show)+"_"+s+'">Next &#187;</a></li>'),c+="</ul></div>"}}else c+='<div id="tipue_search_warning_head">Nothing found</div>'}else h?c+='<div id="tipue_search_warning_head">Nothing found</div><div id="tipue_search_warning">Common words are largely ignored</div>':(c+='<div id="tipue_search_warning_head">Search too short</div>',1==t.minimumLength?c+='<div id="tipue_search_warning">Should be one character or more</div>':c+='<div id="tipue_search_warning">Should be '+t.minimumLength+" characters or more</div>");e("#tipue_search_content").html(c),e("#tipue_search_content").slideDown(200),e("#tipue_search_replaced").click(function(){o(0,!1)}),e(".tipue_search_foot_box").click(function(){var i=e(this).attr("id").split("_");o(parseInt(i[0]),i[1])})}t.newWindow&&(a=' target="_blank"'),s("q")&&(e("#tipue_search_input").val(s("q")),o(0,!0)),e("#tipue_search_button").click(function(){o(0,!0)}),e(this).keyup(function(e){"13"==e.keyCode&&o(0,!0)})})}}(jQuery);
